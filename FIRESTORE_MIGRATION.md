# üî• –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Firebase Firestore

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–ö–∞—Ç–∞–ª–æ–≥ –º–æ–Ω–µ—Ç —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **Firebase Firestore** –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ SQLite.

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–õ–µ–≥–∫–æ –æ–±–Ω–æ–≤–ª—è—Ç—å** –∫–∞—Ç–∞–ª–æ–≥ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- **Offline persistence** - –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- **–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö** (iOS, Android, Web)

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Firestore

```
firestore/
‚îú‚îÄ‚îÄ countries/              # –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å—Ç—Ä–∞–Ω
‚îÇ   ‚îú‚îÄ‚îÄ russia/            # id: russia
‚îÇ   ‚îî‚îÄ‚îÄ israel/            # id: israel
‚îÇ
‚îú‚îÄ‚îÄ periods/               # –ö–æ–ª–ª–µ–∫—Ü–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ russian_empire/   # countryId: russia
‚îÇ   ‚îú‚îÄ‚îÄ ussr/             # countryId: russia
‚îÇ   ‚îú‚îÄ‚îÄ modern_russia/    # countryId: russia
‚îÇ   ‚îî‚îÄ‚îÄ modern_israel/    # countryId: israel
‚îÇ
‚îú‚îÄ‚îÄ rulers/               # –ö–æ–ª–ª–µ–∫—Ü–∏—è –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ peter_i/          # periodId: russian_empire
‚îÇ   ‚îú‚îÄ‚îÄ catherine_ii/     # periodId: russian_empire
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ coins/               # –ö–æ–ª–ª–µ–∫—Ü–∏—è –º–æ–Ω–µ—Ç
    ‚îú‚îÄ‚îÄ coin_001/        # rulerId: peter_i
    ‚îú‚îÄ‚îÄ coin_002/        # rulerId: peter_i
    ‚îî‚îÄ‚îÄ ...
```

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd coin_catalog
node scripts/migrateToFirestore.js
```

–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `catalogData.js`, `ussrCatalogData.js` –∏ `modernRussiaCatalogData.js` –≤ Firestore.

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–í Firebase Console:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `firestore.rules`
3. –ù–∞–∂–º–∏—Ç–µ **Publish**

### 3. –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

Firestore –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ. –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:
- `coins`: `rulerId` (asc) + `year` (asc)
- `coins`: `rulerId` (asc) + `denomination` (asc) + `year` (asc)
- `rulers`: `periodId` (asc) + `startYear` (asc)
- `periods`: `countryId` (asc) + `sortOrder` (asc)

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `services/FirestoreDatabaseService.js` - –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Firestore
- `scripts/migrateToFirestore.js` - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `firestore.rules` - –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `services/database.js` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `FirestoreDatabaseService`
- `app/(tabs)/index.jsx` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `firestoreDatabaseService`

### –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):
- `services/DatabaseService.js` - —Å—Ç–∞—Ä—ã–π SQLite —Å–µ—Ä–≤–∏—Å

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

Firestore –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ:
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ IndexedDB (Web) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (Mobile)
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à
- –û–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à –≤ —Ñ–æ–Ω–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

---

## üìä –õ–∏–º–∏—Ç—ã Firebase (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω)

- **Reads**: 50,000 –≤ –¥–µ–Ω—å
- **Writes**: 20,000 –≤ –¥–µ–Ω—å
- **Deletes**: 20,000 –≤ –¥–µ–Ω—å
- **Storage**: 1 GB

–î–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –º–æ–Ω–µ—Ç —ç—Ç–æ –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!

---

## üõ†Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω—É:

```javascript
await setDoc(doc(db, 'countries', 'usa'), {
  id: 'usa',
  name: '–°–®–ê',
  nameEn: 'United States',
  description: '–°–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –®—Ç–∞—Ç—ã –ê–º–µ—Ä–∏–∫–∏',
});
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥:

```javascript
await setDoc(doc(db, 'periods', 'colonial_usa'), {
  id: 'colonial_usa',
  countryId: 'usa',
  name: '–ö–æ–ª–æ–Ω–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥',
  nameEn: 'Colonial Period',
  startYear: 1776,
  endYear: 1800,
  description: '–†–∞–Ω–Ω–∏–µ –º–æ–Ω–µ—Ç—ã –°–®–ê',
  sortOrder: 1,
});
```

### –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏—Ç–µ–ª—è/–ø–µ—Ä–∏–æ–¥:

```javascript
await setDoc(doc(db, 'rulers', 'washington'), {
  id: 'washington',
  periodId: 'colonial_usa',
  name: '–î–∂–æ—Ä–¥–∂ –í–∞—à–∏–Ω–≥—Ç–æ–Ω',
  nameEn: 'George Washington',
  startYear: 1789,
  endYear: 1797,
  imageUrl: '...',
});
```

### –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—É:

```javascript
await setDoc(doc(db, 'coins', 'coin_usa_001'), {
  id: 'coin_usa_001',
  rulerId: 'washington',
  name: '1 —Ü–µ–Ω—Ç',
  denomination: '1 cent',
  year: 1793,
  metal: '–ú–µ–¥—å',
  weight: 13.48,
  diameter: 28.5,
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
});
```

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
2. ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∞–º–∏
3. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–∏–æ–¥–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
4. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
5. ‚úÖ –ü–æ–∏—Å–∫ –º–æ–Ω–µ—Ç
6. ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –º–æ–Ω–µ—Ç—ã
7. ‚úÖ –†–∞–±–æ—Ç–∞ –æ—Ñ—Ñ–ª–∞–π–Ω (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "Missing or insufficient permissions"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Firebase Console
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã

### –û—à–∏–±–∫–∞: "Index not found"
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –æ—à–∏–±–∫–∏
- –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å –≤ Firebase Console

### –î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ Firestore Console

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Firebase –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firestore
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ Firestore

---

**–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ**
